services:
  accounting-search:
    build: .
    container_name: accounting-search
    restart: unless-stopped
    ports:
      - "8011:8011"
      - "8012:8012"
      - "8503:8503"
    environment:
      # Qdrant Cloud Configuration
      QDRANT_URL: ${QDRANT_URL}
      QDRANT_API_KEY: ${QDRANT_API_KEY}
      # API key for Google Gemini models
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      EMBED_DIM: ${EMBED_DIM:-3072}
      # Summary model provider
      SUMMARY_PROVIDER: ${SUMMARY_PROVIDER:-GEMINI}
      # OpenRouter API key
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY}
      OPENROUTER_MODEL: ${OPENROUTER_MODEL:-openai/gpt-4o-mini}
      # Azure AD credentials
      MS_TENANT_ID: ${MS_TENANT_ID}
      MS_CLIENT_ID: ${MS_CLIENT_ID}
      MS_CLIENT_SECRET: ${MS_CLIENT_SECRET}
      # OneDrive
      ONEDRIVE_DRIVE_ID: ${ONEDRIVE_DRIVE_ID}
      ONEDRIVE_ROOT_PATH: ${ONEDRIVE_ROOT_PATH}
      SCHEDULE_CRON: ${SCHEDULE_CRON}
      # OCR
      OCR_SERVICE_URL: ${OCR_SERVICE_URL}
      # Chunking
      CHUNK_SIZE: ${CHUNK_SIZE:-2000}
      CHUNK_OVERLAP: ${CHUNK_OVERLAP:-200}
      # Operational flags
      DRY_RUN: ${DRY_RUN:-false}
      SKIP_SUMMARY: ${SKIP_SUMMARY:-false}
      MAX_DOCUMENTS: ${MAX_DOCUMENTS:-0}
      # Streamlit
      SEARCH_API_URL: http://localhost:8012/search
      APP_ACCESS_KEY: ${APP_ACCESS_KEY}
    volumes:
      - ./logs:/app/logs
    networks:
      - my_network

networks:
  my_network:
    external: true
    name: my_services_my_network
